<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Iniciando Sesión...</title>
</head>
<body>
<p style="font-family: sans-serif; text-align: center; margin-top: 50px;">
    Iniciando sesión, por favor espera...
</p>

<script th:inline="javascript">
    /*<![CDATA[*/

    const userRole = /*[[${userRole}]]*/ 'none';

    // 2. Creamos un objeto de usuario MINIMAL en el frontend
    // NOTA: Mantenemos la estructura mínima (id, name, role) para que el JS del menú funcione.
    let user = null;
    if (userRole === 'admin') {
        user = {
            // Usamos datos genéricos, asumiendo que el profile fetch completará los detalles.
            id: 99,
            name: 'Administrador',
            role: 'admin',
        };
    } else if (userRole === 'contributor') {
        user = {
            id: 1,
            name: 'Contribuyente',
            role: 'contributor',
        };
    }

    if (user) {
        sessionStorage.setItem('currentUser', JSON.stringify(user));
    }

    if (userRole === 'admin') {
        window.location.href = '/admin';
    } else if (userRole === 'contributor') {
        window.location.href = '/contributor';
    } else {
        window.location.href = '/';
    }

    /*]]>*/
</script>
</body>
</html>